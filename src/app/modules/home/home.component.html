<!-- Loading State -->
<div *ngIf="isLoading" class="flex items-center justify-center min-h-screen">
  <div class="text-center">
    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"></div>
    <p class="mt-4 text-gray-600">Loading your home page...</p>
  </div>
</div>

<!-- Main Content -->
<div *ngIf="!isLoading" class="p-6">
  <!-- Welcome Section -->
  <div class="flex flex-col sm:flex-row flex-auto sm:items-center min-w-0 my-8 sm:my-12">
    <div class="flex flex-auto items-center min-w-0">
      <div class="flex-0 w-16 h-16 rounded-full overflow-hidden bg-orange-100 flex items-center justify-center">
        <mat-icon class="text-orange-600" [svgIcon]="'heroicons_outline:user-circle'"></mat-icon>
      </div>
      <div class="flex flex-col min-w-0 ml-4">
        <div class="text-2xl md:text-5xl tracking-tight leading-7 md:leading-snug truncate">
          Welcome back, <span class="text-orange-500">{{ user?.firstName | titlecase }}</span>!
        </div>
        <div class="flex items-center mt-2">
          <mat-icon class="icon-size-4 text-gray-500" [svgIcon]="'heroicons_outline:bell'"></mat-icon>
          <div class="ml-1.5 leading-6 truncate text-secondary">
            Here's an overview of your accessible modules
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Module Cards Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" *ngIf="moduleAccesses.length > 0">
    <!-- Asset Module Card -->
    <div *ngIf="hasAccess(ModuleTypes.Asset)"
         class="bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow cursor-pointer"
         (click)="navigateToModule(ModuleTypes.Asset)">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="p-3 bg-blue-50 rounded-lg">
            <mat-icon class="text-blue-600" [svgIcon]="getModuleIcon(ModuleTypes.Asset)"></mat-icon>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-900">{{ getModuleDisplayName(ModuleTypes.Asset) }}</h3>
        </div>
      </div>
      <div class="mb-4">
        <p class="text-3xl font-bold text-gray-900">{{ moduleStats.asset?.total || 0 }}</p>
        <p class="text-sm text-gray-500 mt-1">Total Assets</p>
      </div>
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <span class="text-xs px-2 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': getAccessType(ModuleTypes.Asset) === AccessType.FullAccess,
                'bg-blue-100 text-blue-800': getAccessType(ModuleTypes.Asset) === AccessType.ReadWrite,
                'bg-gray-100 text-gray-800': getAccessType(ModuleTypes.Asset) === AccessType.Read
              }">
          {{ getAccessType(ModuleTypes.Asset) }}
        </span>
        <button *ngIf="canCreate(ModuleTypes.Asset)"
                (click)="navigateToCreate(ModuleTypes.Asset); $event.stopPropagation()"
                class="text-sm text-orange-600 hover:text-orange-700 font-medium">
          Create New
        </button>
      </div>
    </div>

    <!-- Ticket Module Card -->
    <div *ngIf="hasAccess(ModuleTypes.Ticket)"
         class="bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow cursor-pointer"
         (click)="navigateToModule(ModuleTypes.Ticket)">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="p-3 bg-purple-50 rounded-lg">
            <mat-icon class="text-purple-600" [svgIcon]="getModuleIcon(ModuleTypes.Ticket)"></mat-icon>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-900">{{ getModuleDisplayName(ModuleTypes.Ticket) }}</h3>
        </div>
      </div>
      <div class="mb-4">
        <p class="text-3xl font-bold text-gray-900">{{ moduleStats.ticket?.total || 0 }}</p>
        <p class="text-sm text-gray-500 mt-1">Total Tickets</p>
      </div>
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <span class="text-xs px-2 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': getAccessType(ModuleTypes.Ticket) === AccessType.FullAccess,
                'bg-blue-100 text-blue-800': getAccessType(ModuleTypes.Ticket) === AccessType.ReadWrite,
                'bg-gray-100 text-gray-800': getAccessType(ModuleTypes.Ticket) === AccessType.Read
              }">
          {{ getAccessType(ModuleTypes.Ticket) }}
        </span>
        <button *ngIf="canCreate(ModuleTypes.Ticket)"
                (click)="navigateToCreate(ModuleTypes.Ticket); $event.stopPropagation()"
                class="text-sm text-orange-600 hover:text-orange-700 font-medium">
          Create New
        </button>
      </div>
    </div>

    <!-- UAM Module Card -->
    <div *ngIf="hasAccess(ModuleTypes.UAM)"
         class="bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow cursor-pointer"
         (click)="navigateToModule(ModuleTypes.UAM)">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="p-3 bg-yellow-50 rounded-lg">
            <mat-icon class="text-yellow-600" [svgIcon]="getModuleIcon(ModuleTypes.UAM)"></mat-icon>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-900">{{ getModuleDisplayName(ModuleTypes.UAM) }}</h3>
        </div>
      </div>
      <div class="mb-4">
        <p class="text-3xl font-bold text-gray-900">{{ moduleStats.uam?.total || 0 }}</p>
        <p class="text-sm text-gray-500 mt-1">Total UAM Requests</p>
      </div>
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <span class="text-xs px-2 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': getAccessType(ModuleTypes.UAM) === AccessType.FullAccess,
                'bg-blue-100 text-blue-800': getAccessType(ModuleTypes.UAM) === AccessType.ReadWrite,
                'bg-gray-100 text-gray-800': getAccessType(ModuleTypes.UAM) === AccessType.Read
              }">
          {{ getAccessType(ModuleTypes.UAM) }}
        </span>
        <button *ngIf="canCreate(ModuleTypes.UAM)"
                (click)="navigateToCreate(ModuleTypes.UAM); $event.stopPropagation()"
                class="text-sm text-orange-600 hover:text-orange-700 font-medium">
          Create New
        </button>
      </div>
    </div>

    <!-- Audit Module Card -->
    <div *ngIf="hasAccess(ModuleTypes.Audit)"
         class="bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow cursor-pointer"
         (click)="navigateToModule(ModuleTypes.Audit)">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="p-3 bg-green-50 rounded-lg">
            <mat-icon class="text-green-600" [svgIcon]="getModuleIcon(ModuleTypes.Audit)"></mat-icon>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-900">{{ getModuleDisplayName(ModuleTypes.Audit) }}</h3>
        </div>
      </div>
      <div class="mb-4">
        <p class="text-3xl font-bold text-gray-900">{{ moduleStats.audit?.total || 0 }}</p>
        <p class="text-sm text-gray-500 mt-1">Total Audits</p>
      </div>
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <span class="text-xs px-2 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': getAccessType(ModuleTypes.Audit) === AccessType.FullAccess,
                'bg-blue-100 text-blue-800': getAccessType(ModuleTypes.Audit) === AccessType.ReadWrite,
                'bg-gray-100 text-gray-800': getAccessType(ModuleTypes.Audit) === AccessType.Read
              }">
          {{ getAccessType(ModuleTypes.Audit) }}
        </span>
        <button *ngIf="canCreate(ModuleTypes.Audit)"
                (click)="navigateToCreate(ModuleTypes.Audit); $event.stopPropagation()"
                class="text-sm text-orange-600 hover:text-orange-700 font-medium">
          Create New
        </button>
      </div>
    </div>

    <!-- Vendor Module Card -->
    <div *ngIf="hasAccess(ModuleTypes.Vendor)"
         class="bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow cursor-pointer"
         (click)="navigateToModule(ModuleTypes.Vendor)">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="p-3 bg-indigo-50 rounded-lg">
            <mat-icon class="text-indigo-600" [svgIcon]="getModuleIcon(ModuleTypes.Vendor)"></mat-icon>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-900">{{ getModuleDisplayName(ModuleTypes.Vendor) }}</h3>
        </div>
      </div>
      <div class="mb-4">
        <p class="text-3xl font-bold text-gray-900">{{ moduleStats.vendor?.total || 0 }}</p>
        <p class="text-sm text-gray-500 mt-1">Total Vendors</p>
      </div>
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <span class="text-xs px-2 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': getAccessType(ModuleTypes.Vendor) === AccessType.FullAccess,
                'bg-blue-100 text-blue-800': getAccessType(ModuleTypes.Vendor) === AccessType.ReadWrite,
                'bg-gray-100 text-gray-800': getAccessType(ModuleTypes.Vendor) === AccessType.Read
              }">
          {{ getAccessType(ModuleTypes.Vendor) }}
        </span>
        <button *ngIf="canCreate(ModuleTypes.Vendor)"
                (click)="navigateToCreate(ModuleTypes.Vendor); $event.stopPropagation()"
                class="text-sm text-orange-600 hover:text-orange-700 font-medium">
          Create New
        </button>
      </div>
    </div>

    <!-- Branch Module Card -->
    <div *ngIf="hasAccess(ModuleTypes.Branch)"
         class="bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow cursor-pointer"
         (click)="navigateToModule(ModuleTypes.Branch)">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="p-3 bg-red-50 rounded-lg">
            <mat-icon class="text-red-600" [svgIcon]="getModuleIcon(ModuleTypes.Branch)"></mat-icon>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-900">{{ getModuleDisplayName(ModuleTypes.Branch) }}</h3>
        </div>
      </div>
      <div class="mb-4">
        <p class="text-3xl font-bold text-gray-900">{{ moduleStats.branch?.total || 0 }}</p>
        <p class="text-sm text-gray-500 mt-1">Total Branches</p>
      </div>
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <span class="text-xs px-2 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': getAccessType(ModuleTypes.Branch) === AccessType.FullAccess,
                'bg-blue-100 text-blue-800': getAccessType(ModuleTypes.Branch) === AccessType.ReadWrite,
                'bg-gray-100 text-gray-800': getAccessType(ModuleTypes.Branch) === AccessType.Read
              }">
          {{ getAccessType(ModuleTypes.Branch) }}
        </span>
        <button *ngIf="canCreate(ModuleTypes.Branch)"
                (click)="navigateToCreate(ModuleTypes.Branch); $event.stopPropagation()"
                class="text-sm text-orange-600 hover:text-orange-700 font-medium">
          Create New
        </button>
      </div>
    </div>

    <!-- Department Module Card -->
    <div *ngIf="hasAccess(ModuleTypes.Department)"
         class="bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow cursor-pointer"
         (click)="navigateToModule(ModuleTypes.Department)">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="p-3 bg-teal-50 rounded-lg">
            <mat-icon class="text-teal-600" [svgIcon]="getModuleIcon(ModuleTypes.Department)"></mat-icon>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-gray-900">{{ getModuleDisplayName(ModuleTypes.Department) }}</h3>
        </div>
      </div>
      <div class="mb-4">
        <p class="text-3xl font-bold text-gray-900">{{ moduleStats.department?.total || 0 }}</p>
        <p class="text-sm text-gray-500 mt-1">Total Departments</p>
      </div>
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <span class="text-xs px-2 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': getAccessType(ModuleTypes.Department) === AccessType.FullAccess,
                'bg-blue-100 text-blue-800': getAccessType(ModuleTypes.Department) === AccessType.ReadWrite,
                'bg-gray-100 text-gray-800': getAccessType(ModuleTypes.Department) === AccessType.Read
              }">
          {{ getAccessType(ModuleTypes.Department) }}
        </span>
        <button *ngIf="canCreate(ModuleTypes.Department)"
                (click)="navigateToCreate(ModuleTypes.Department); $event.stopPropagation()"
                class="text-sm text-orange-600 hover:text-orange-700 font-medium">
          Create New
        </button>
      </div>
    </div>
  </div>

  <!-- No Access Message -->
  <div *ngIf="!hasAnyAccess()"
       class="bg-white rounded-lg shadow-md border border-gray-200 p-12 text-center">
    <mat-icon class="text-gray-400 mb-4" style="font-size: 64px; width: 64px; height: 64px;">heroicons_outline:lock-closed</mat-icon>
    <h3 class="text-xl font-semibold text-gray-900 mb-2">No Access Granted</h3>
    <p class="text-gray-500">You don't have access to any modules yet. Please contact your administrator.</p>
  </div>

  <!-- Allocated Assets Section -->
  <div *ngIf="hasAccess(ModuleTypes.Asset) && user?._id" class="mt-8">
    <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">My Allocated Assets</h3>
      </div>
      <div class="p-6">
        <!-- Loading State -->
        <div *ngIf="isLoadingAssets" class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"></div>
          <p class="mt-2 text-sm text-gray-600">Loading assets...</p>
        </div>

        <!-- No Assets -->
        <div *ngIf="!isLoadingAssets && allocatedAssets.length === 0" class="text-center py-8 text-gray-500">
          <mat-icon class="text-gray-400 mb-2" style="font-size: 48px; width: 48px; height: 48px;">heroicons_outline:archive</mat-icon>
          <p class="text-sm">No assets allocated to you</p>
        </div>

        <!-- Assets Grid -->
        <div *ngIf="!isLoadingAssets && allocatedAssets.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div
            *ngFor="let asset of allocatedAssets"
            (click)="openAssetDetail(asset)"
            class="border border-gray-200 rounded-lg p-4 hover:bg-orange-50 hover:border-orange-300 cursor-pointer transition-colors"
          >
            <div class="flex items-start justify-between">
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-2">
                  <h4 class="text-sm font-semibold text-gray-900">{{ getAssetDisplayName(asset) }}</h4>
                  <span class="px-2 py-0.5 text-xs font-medium rounded-md bg-blue-100 text-blue-800">
                    {{ getAssetType(asset) }}
                  </span>
                </div>
                <div class="grid grid-cols-1 gap-2 text-xs text-gray-600">
                  <div>
                    <span class="font-medium">Serial No:</span>
                    <span class="ml-1">{{ getAssetSerialNumber(asset) }}</span>
                  </div>
                  <div *ngIf="asset.assetCode">
                    <span class="font-medium">Asset Code:</span>
                    <span class="ml-1">{{ asset.assetCode }}</span>
                  </div>
                </div>
              </div>
              <mat-icon class="text-gray-400 flex-shrink-0 ml-2">heroicons_outline:chevron-right</mat-icon>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
