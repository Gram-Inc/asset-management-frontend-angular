<!-- This example requires Tailwind CSS v2.0+ -->
<div class="container mx-auto p-8" [formGroup]="auditForm">
  <div class="flex-1 min-w-0">
    <h1 class="text-2xl tracking-tight font-medium text-gray-800 sm:text-2xl md:text-2xl">
      <span class="block xl:inline">Create</span>
      <span class="block text-orange-600 xl:inline"> Audit</span>
    </h1>
  </div>
  <div class="mt-5 lg:ml-4">
    <div class="px-4 py-5 bg-white sm:p-6">
      <div class="grid grid-cols-6 gap-6">
        <!-- Audit Name -->
        <div class="col-span-6 sm:col-span-4">
          <label for="name" class="block text-sm font-medium text-gray-700">Audit Name</label>
          <input
            type="text"
            [formControlName]="'name'"
            [class]="
              auditForm.controls['name'].invalid && auditForm.controls['name'].touched
                ? 'border-red-500'
                : 'border-gray-300'
            "
            class="
              mt-1
              focus:ring-orange-500 focus:border-orange-500
              block
              w-full
              shadow-sm
              sm:text-sm
              border
              rounded-md
              px-3
              py-2
            "
            placeholder="Enter audit name"
          />
          <span
            *ngIf="
              auditForm.controls['name'].invalid &&
              (auditForm.controls['name'].dirty || auditForm.controls['name'].touched)
            "
            class="text-xs text-red-700"
            >*Required.</span
          >
        </div>

        <!-- Branch -->
        <div class="col-span-6 sm:col-span-3">
          <label for="branchId" class="block text-sm font-medium text-gray-700">Branch</label>
          <select
            [formControlName]="'branchId'"
            [class]="
              auditForm.controls['branchId'].invalid && auditForm.controls['branchId'].touched
                ? 'border-red-500'
                : 'border-gray-300'
            "
            class="
              mt-1
              focus:ring-orange-500 focus:border-orange-500
              block
              w-full
              shadow-sm
              sm:text-sm
              border
              rounded-md
              px-3
              py-2
            "
          >
            <option value="">Select Branch</option>
            <option *ngFor="let branch of branches" [value]="branch._id">
              {{ branch.name }}
            </option>
          </select>
          <span
            *ngIf="
              auditForm.controls['branchId'].invalid &&
              (auditForm.controls['branchId'].dirty || auditForm.controls['branchId'].touched)
            "
            class="text-xs text-red-700"
            >*Required.</span
          >
        </div>

        <!-- Departments -->
        <div class="col-span-6 sm:col-span-3">
          <label for="departmentIds" class="block text-sm font-medium text-gray-700">Departments</label>
          <select
            [formControlName]="'departmentIds'"
            multiple
            [class]="
              auditForm.controls['departmentIds'].invalid && auditForm.controls['departmentIds'].touched
                ? 'border-red-500'
                : 'border-gray-300'
            "
            class="
              mt-1
              focus:ring-orange-500 focus:border-orange-500
              block
              w-full
              shadow-sm
              sm:text-sm
              border
              rounded-md
              px-3
              py-2
            "
            size="5"
          >
            <option *ngFor="let dept of departments" [value]="dept._id">
              {{ dept.name }}
            </option>
          </select>
          <p class="text-xs text-gray-500 mt-1">
            Hold Ctrl/Cmd to select multiple departments
          </p>
          <span
            *ngIf="
              auditForm.controls['departmentIds'].invalid &&
              (auditForm.controls['departmentIds'].dirty || auditForm.controls['departmentIds'].touched)
            "
            class="text-xs text-red-700"
            >*Required.</span
          >
        </div>

        <!-- Assign to User -->
        <div class="col-span-6 sm:col-span-3">
          <label for="assignedToUserId" class="block text-sm font-medium text-gray-700">Assign to User (Optional)</label>
          <select
            [formControlName]="'assignedToUserId'"
            class="
              mt-1
              focus:ring-orange-500 focus:border-orange-500
              block
              w-full
              shadow-sm
              sm:text-sm
              border
              border-gray-300
              rounded-md
              px-3
              py-2
            "
          >
            <option value="">None</option>
            <option *ngFor="let user of level2Users" [value]="user._id">
              {{ user.firstName }} {{ user.lastName }}
            </option>
          </select>
        </div>

        <!-- Asset Selection -->
        <div class="col-span-6 sm:col-span-3">
          <label class="block text-sm font-medium text-gray-700 mb-2">Asset Selection</label>
          <div class="flex items-center mb-2">
            <input
              type="checkbox"
              [checked]="includeAllAssets"
              (change)="toggleAssetSelection()"
              class="mr-2 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"
            />
            <span class="text-sm text-gray-700">Include all assets from selected branch and departments</span>
          </div>
          <p class="text-xs text-gray-500">
            {{
              includeAllAssets
                ? "All assets matching the branch and departments will be included"
                : "Manual asset selection (coming soon)"
            }}
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="flex items-center justify-center sm:justify-end px-6 py-4 space-x-3">
    <!-- Cancel -->
    <ng-container>
      <button mat-stroked-button [routerLink]="['../']">Back</button>
    </ng-container>

    <!-- Confirm -->
    <ng-container>
      <span class="sm:ml-3">
        <button
          type="button"
          class="
            inline-flex
            items-center
            px-4
            py-2
            border border-transparent
            rounded-md
            shadow-sm
            text-sm
            font-medium
            text-white
            bg-orange-600
            hover:bg-orange-700
            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500
            disabled:bg-gray-400
            disabled:cursor-not-allowed
          "
          (click)="onSubmit()"
          [disabled]="auditForm.invalid"
        >
          <!-- Heroicon name: solid/check -->
          <mat-icon class="-ml-1 mr-2 h-5 w-5" svgIcon="heroicons_outline:plus"></mat-icon>

          Create Audit
        </button>
      </span>
    </ng-container>
  </div>
</div>
